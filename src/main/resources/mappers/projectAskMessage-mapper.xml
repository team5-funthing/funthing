<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="projectAskMessageDAO">
 	
 	<!-- 프로젝트 문의글 등록 -->
 	<insert id="insertProjectAskContents"  parameterType="projectAskMessage">
		INSERT INTO projectAskMessage(projectAskNo, email, creator,projectAskContentsTitle, projectAskContents, projectAskref, projectAskDate) 
		VALUES(projectAskMessage_seq.nextval, #{email},#{creator},#{projectAskContentsTitle},#{projectAskContents}, projectAskMessage_seq.currval, sysdate )
	</insert>
	
	<!-- 답변글 등록 (업데이트로 해줘야해) 그러면서 답변상태도 변경 -->
	<update id="updateProjectAskReplyContentsStatus" parameterType="projectAskMessage">
		UPDATE projectAskMessage 
		SET 
		projectAskReplyContentsTitle = #{projectAskReplyContentsTitle},
		projectAskReplyContents = #{projectAskReplyContents},
		projectAskReplyStatus = #{projectAskReplyStatus},
		projectAskReplyDate = sysdate WHERE projectAskNo = #{projectAskNo}
	</update>
	
	<!-- 선택한 문의글 가져오기  -->
	<select id="getChoiceProjectAskMessage" resultType="projectAskMessage" parameterType="projectAskMessage">
		SELECT * FROM projectAskMessage WHERE projectAskNo = #{projectAskNo}
	</select>
	
	<!-- 그아이디 관련 전체 문의글 가져오기 -->
	<select id="getEntireProjectAskMessageList" resultType="projectAskMessage" parameterType="projectAskMessage">
		SELECT * FROM projectAskMessage where email = #{email}
	
	</select>
	
	<!-- 멤버테이블과 메이커멤버테이블을 조인하여 메이커(창작자명) 가져오기 -->
	
	<resultMap type="userCreator" id="userCreator">
		<result column="creator" property="creator" />
		<result column="email" property="email" />
	</resultMap>

	<resultMap type="member" id="member">
		<result column="email" property="email" />
		<result column="name" property="name" />
		<collection property="userCreator" resultMap="userCreator"></collection>
	</resultMap>
 	
 	<select id="getMakerMemberCreator" parameterType="member"  resultMap="member">
		select userCreator.creator, member.name, member.email from member join userCreator on userCreator.email = #{email} and member.email= #{email}
	</select>
	
	<!-- 메이커 관련 전체 문의글 가져오기 -->
	<select id="getEntireProjectMakerAskMessageList" resultType="projectAskMessage" parameterType="projectAskMessage">
		SELECT * FROM projectAskMessage where creator = #{creator}
	
	</select>
	
	
	
 </mapper>